<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:pe="http://primefaces.org/ui/extensions"
                xmlns="http://www.w3.org/1999/xhtml">

    <p:panelGrid id="inquiryPanel" style="border:hidden !important;vertical-align: text-top !important;width:98%;" 
                  columns="2" layout="grid" columnClasses="ui-grid-col-12,ui-grid-col-12"
                 styleClass="ui-panelgrid-blank"
                 >
        
        <p:fieldset legend="#{message['Inquiry.OrderDetails']}" toggleable="true" toggleSpeed="500">
            <p:panelGrid id="orderDetail" >
                <p:row>
                    <p:column><h:outputLabel value="#{message['Inquiry.OrderNo']}"></h:outputLabel> </p:column>
                    <p:column>
                        <p:inputText id="orderno" value="#{orderInquiry.instance.orderInfo.orderNo}" 
                                     required="#{orderInquiry.required}"></p:inputText>
                        <p:spacer width="10"></p:spacer>
                        <p:commandButton value="Bul" icon="fa fa-search white" iconPos="right"                                                 
                                         update=":inqyTab:formSearch:searchGrid" 
                                         oncomplete="PF('searchDialog').show();"
                                         rendered="#{helper.activeMerchantOrderSearch and !orderInquiry.instance.managed}"></p:commandButton>
                    </p:column>
                    <p:column><p:message for="orderno"></p:message></p:column>
                </p:row>
                <p:row>
                    <p:column><h:outputLabel value="#{message['Inquiry.OrderDate']}"></h:outputLabel> </p:column>
                    <p:column>
                        <p:calendar id="edtOrderDate" 
                                    pattern="dd/MM/yyyy" 
                                    navigator="true" mask="true" 
                                    showOn="button" size="12" 
                                    value="#{orderInquiry.instance.orderInfo.orderDate}" 
                                    required="#{orderInquiry.required}"></p:calendar>
                    </p:column>
                    <p:column><p:message for="edtOrderDate"></p:message></p:column>
                </p:row>
                <p:row>
                    <p:column><h:outputLabel value="#{message['Inquiry.MemberName']} #{message['Inquiry.MemberSurname']}"></h:outputLabel> </p:column>
                    <p:column>
                        <p:inputText id="edtMembername" value="#{orderInquiry.instance.orderInfo.memberName}" required="#{orderInquiry.required}"></p:inputText>
                        <h:outputText value=" - "></h:outputText>
                        <p:inputText id="edtMembesurname" value="#{orderInquiry.instance.orderInfo.memberSurname}" required="#{orderInquiry.required}"></p:inputText>
                    </p:column>
                    <p:column><p:message for="edtMembername"></p:message><p:message for="edtMembesurname"></p:message></p:column>
                </p:row>
                <p:row>
                    <p:column><h:outputLabel value="#{message['Inquiry.MemberUsername']}"></h:outputLabel> </p:column>
                    <p:column>
                        <p:inputText id="edtMemberusername" 
                                     value="#{orderInquiry.instance.orderInfo.memberUsername}" 
                                     required="#{orderInquiry.required}" size="60"></p:inputText>
                    </p:column>
                    <p:column><p:message for="edtMemberusername"></p:message></p:column>
                </p:row>
                <p:row>
                    <p:column><h:outputLabel value="#{message['Inquiry.Marketplace']}"></h:outputLabel> </p:column>
                    <p:column>
                        <p:selectOneMenu id="edtMarketplace" value="#{orderInquiry.instance.orderInfo.marketPlace}" 
                                         valueChangeListener="#{orderInquiry.marketPlaceValueChange}"
                                         required="#{orderInquiry.required}">
                                <f:selectItem noSelectionOption="true" itemLabel="Seçiniz"/>
                                <f:selectItems value="#{enums.marketplaceSelect}"></f:selectItems>                                    
                                <p:ajax immediate="true" 
                                        update=":inqyTab:formEdit:edtAgency" process="@this"></p:ajax>
                        </p:selectOneMenu>
                        <p:spacer width="10px"/>
                        <p:selectOneMenu id="edtAgency" value="#{orderInquiry.instance.orderInfo.agent}"
                                         converter="omnifaces.SelectItemsConverter"
                                         required="#{orderInquiry.required}" requiredMessage="Acente seçimi yapmadınız!"
                                         >
                                    <f:selectItem noSelectionOption="true" itemLabel="Seçiniz" />
                                    <f:selectItems value="#{orderInquiry.agents}" 
                                                   var="agent" itemLabel="#{agent.agentName}" itemValue="#{agent}"></f:selectItems>    

                        </p:selectOneMenu>
                    </p:column>
                    <p:column><p:message for="edtMarketplace"></p:message><p:message for="edtAgency"></p:message></p:column>
                </p:row>
                <p:row>
                    <p:column><h:outputLabel value="#{message['Inquiry.OrderAmount']}"></h:outputLabel> </p:column>
                    <p:column style="vertical-align: top !important;">
                        <p:panelGrid columns="2" style="border-style: hidden !important;" >
                            <p:inputText id="edtAmount"
                                     value="#{orderInquiry.instance.orderInfo.orderTotal}"
                                     required="#{orderInquiry.required}" size="18" maxlength="16"/>
                            <p:selectOneMenu id="edtCurrency"
                                         value="#{orderInquiry.instance.orderInfo.orderCurrency}"
                                         required="#{orderInquiry.required}">
                                <f:selectItems value="#{enums.currencySelect}"></f:selectItems>
                            </p:selectOneMenu>
                        </p:panelGrid>

                    </p:column>
                    <p:column><p:message for="edtAmount"></p:message><p:message for="edtCurrency"></p:message></p:column>
                </p:row>
                <p:row>
                    <p:column><h:outputLabel value="#{message['Inquiry.OrderStatus']}"></h:outputLabel> </p:column>
                    <p:column>                               
                        <p:selectOneMenu id="edtOrderStatus"
                                         value="#{orderInquiry.instance.orderInfo.orderStatus}"
                                         converter="omnifaces.SelectItemsConverter"
                                         required="#{orderInquiry.required}">
                            <f:selectItem noSelectionOption="true" itemLabel="Seçiniz"/>
                            <f:selectItems value="#{orderInquiry.orderStatuses}" 
                                           var="ordsts" itemLabel="#{ordsts.statusDescription}" itemValue="#{ordsts}"></f:selectItems>
                        </p:selectOneMenu>
                    </p:column>
                    <p:column><p:message for="edtOrderStatus"></p:message></p:column>
                </p:row>
                <p:row>
                    <p:column colspan="4">
                        <p:dataTable value="#{orderInquiry.instance.orderProducts}" var="prdct" editable="true" style="width:800px;" id="orderProductTable">
                           <f:facet name="header">
                               <h:outputText value="#{message['Inquiry.OrderProducts']} "></h:outputText>
                                <p:commandButton value="#{message['Global.NewRecord']}" 
                                                actionListener="#{orderInquiry.newOrderProduct()}" 
                                                update=":inqyTab:formEdit:orderProductTable"
                                                class="RedButton" process="@this"
                                                ></p:commandButton>

                           </f:facet>
                           <p:ajax event="rowEdit" listener="#{orderInquiry.onRowEdit}"  />
                           <p:ajax event="rowEditCancel" listener="#{orderInquiry.onRowCancel}"  />
                           <p:ajax event="rowEditInit" listener="#{orderInquiry.onEditInit}"  />

                           <p:column headerText="#{message['Inquiry.ProductCode']}">
                               <p:cellEditor>
                                   <f:facet name="output"><h:outputText value="#{prdct.productCode}" /></f:facet>
                                   <f:facet name="input"><p:inputText value="#{prdct.productCode}" style="width:100%"/></f:facet>
                               </p:cellEditor>
                           </p:column>

                           <p:column headerText="#{message['Inquiry.ProductName']}">
                               <p:cellEditor>
                                   <f:facet name="output"><h:outputText value="#{prdct.productName}" /></f:facet>
                                   <f:facet name="input"><p:inputText value="#{prdct.productName}" style="width:100%" /></f:facet>
                               </p:cellEditor>
                           </p:column>
                           <p:column headerText="#{message['Inquiry.ProductCategory']}">
                               <p:cellEditor>
                                   <f:facet name="output"><h:outputText value="#{prdct.productCategory.categoryDesc}" /></f:facet>
                                   <f:facet name="input">
                                       <p:selectOneMenu value="#{prdct.productCategory}"
                                                        converter="omnifaces.SelectItemsConverter"
                                                        required="false"
                                                        valueChangeListener="#{orderInquiry.categoryValueChange}"
                                                        >
                                            <f:selectItem noSelectionOption="true" itemLabel="Seçiniz"/>
                                            <f:selectItems value="#{orderInquiry.prodcutCategories}" 
                                                           var="prdctCat" itemLabel="#{prdctCat.categoryDesc}" itemValue="#{prdctCat}"></f:selectItems>
                                            <p:ajax immediate="true" 
                                                    update=":inqyTab:formEdit:orderProductTable:prdctSubCategoryCell" process="@this"></p:ajax>
                                       </p:selectOneMenu>
                                   </f:facet>
                               </p:cellEditor>
                           </p:column>
                           <p:column headerText="#{message['Inquiry.ProductSubCategory']}">
                               <p:cellEditor id="prdctSubCategoryCell">
                                   <f:facet name="output"><h:outputText value="#{prdct.productSubCategory.subCategoryDescription}" /></f:facet>
                                   <f:facet name="input">
                                       <p:selectOneMenu value="#{prdct.productSubCategory}"
                                                        converter="omnifaces.SelectItemsConverter"
                                                        required="false">
                                            <f:selectItem noSelectionOption="true" itemLabel="Seçiniz"/>
                                            <f:selectItems value="#{orderInquiry.loadSubCategories(prdct.productCategory)}" 
                                                           var="prdctSubCat" itemLabel="#{prdctSubCat.subCategoryDescription}" itemValue="#{prdctSubCat}"></f:selectItems>
                                       </p:selectOneMenu>
                                   </f:facet>
                               </p:cellEditor>
                           </p:column>
                           <p:column headerText="#{message['Global.Quantity']}" >
                                <p:cellEditor>
                                    <f:facet name="output"><h:outputText value="#{prdct.quantity}"><f:convertNumber groupingUsed="true"  maxFractionDigits="0" type="number" /></h:outputText> </f:facet>
                                    <f:facet name="input">
                                        <pe:inputNumber id="quantity" value="#{prdct.quantity}" maxlength="5" style="width:60px;">                                                    
                                        </pe:inputNumber>  
                                    </f:facet>
                                </p:cellEditor>
                            </p:column>
                            <p:column headerText="#{message['Global.Price']}">
                                <p:cellEditor>
                                    <f:facet name="output"><h:outputText value="#{prdct.price}"><f:convertNumber groupingUsed="true"  maxFractionDigits="0" type="number" /></h:outputText> </f:facet>
                                    <f:facet name="input">
                                        <pe:inputNumber id="price" value="#{prdct.price}" maxlength="5" style="width:60px;">                                                    
                                        </pe:inputNumber>  
                                    </f:facet>
                                </p:cellEditor>
                            </p:column>                                    
                            <p:column style="width:32px">
                                <p:rowEditor>

                                </p:rowEditor>

                            </p:column>
                            <p:column style="width:32px">
                                <p:commandButton icon="ui-icon-trash" action="#{orderInquiry.removeOrderProductRecord(prdct)}" 
                                                  update=":inqyTab:formEdit:orderProductTable" process="@this" />
                            </p:column>

                       </p:dataTable>
                    </p:column>

                </p:row>
            </p:panelGrid>
        </p:fieldset>                

        <p:fieldset legend="#{message['Inquiry.PaymentDetails']}" toggleable="true" toggleSpeed="500">
            <p:panelGrid id="paymentDetail">
                <p:row>
                    <p:column><h:outputLabel value="#{message['Inquiry.PaymentType']}"></h:outputLabel> </p:column>
                    <p:column>
                        <p:selectOneMenu id="edtPaymentType" value="#{orderInquiry.instance.paymentInfo.paymentMethod}" 
                                          required="false">
                                <f:selectItem noSelectionOption="true" itemLabel="Seçiniz"/>
                                <f:selectItems value="#{enums.paymentTypeSelect}"></f:selectItems>                                    
                        </p:selectOneMenu>         
                    </p:column>
                    <p:column><p:message for="edtPaymentType"></p:message></p:column>
                </p:row>
                <p:row>
                    <p:column><h:outputLabel value="#{message['Inquiry.PaymentSecureType']}"></h:outputLabel> </p:column>
                    <p:column>
                        <p:selectOneMenu id="edtPaymentSecureType" value="#{orderInquiry.instance.paymentInfo.paymentSecureType}" 
                                          required="false">
                                <f:selectItem noSelectionOption="true" itemLabel="Seçiniz"/>
                                <f:selectItems value="#{enums.paymentSecureTypeSelect}"></f:selectItems>                                    
                        </p:selectOneMenu>         
                    </p:column>
                    <p:column><p:message for="edtPaymentSecureType"></p:message></p:column>
                </p:row>
                <p:row>
                    <p:column><h:outputLabel value="#{message['Inquiry.FraudController']}"></h:outputLabel> </p:column>
                    <p:column>
                        <p:selectOneMenu id="edtFraudController" value="#{orderInquiry.instance.paymentInfo.fraudController}" 
                                         converter="omnifaces.SelectItemsConverter"
                                         required="false">
                                <f:selectItem noSelectionOption="true" itemLabel="Seçiniz"/>
                                <f:selectItems value="#{orderInquiry.merchantFraudControllers}" 
                                               var="frucntrl" itemLabel="#{frucntrl.nameSurname}" itemValue="#{frucntrl}"></f:selectItems>                          
                        </p:selectOneMenu>         
                    </p:column>
                    <p:column><p:message for="edtFraudController"></p:message></p:column>
                </p:row>
                <p:row>
                    <p:column><h:outputLabel value="#{message['Inquiry.PosBank']}"></h:outputLabel> </p:column>
                    <p:column>
                        <p:selectOneMenu id="edtPosBank" value="#{orderInquiry.instance.paymentInfo.posBank}" 
                                         converter="omnifaces.SelectItemsConverter"
                                         required="false">
                                <f:selectItem noSelectionOption="true" itemLabel="Seçiniz"/>
                                <f:selectItems value="#{orderInquiry.posBanks}" 
                                               var="bank" itemLabel="#{bank.bankName}" itemValue="#{bank}"></f:selectItems>                          
                        </p:selectOneMenu>         
                    </p:column>
                    <p:column><p:message for="edtPosBank"></p:message></p:column>
                </p:row>
                <p:row>
                    <p:column><h:outputLabel value="#{message['Inquiry.Chargeback.CreditCard']}"></h:outputLabel> </p:column>
                    <p:column>
                        <p:inputMask id="cbCreditCard" value="#{orderInquiry.instance.paymentInfo.creditCardNo}" 
                                     mask="9999-99XX-XXXX-9999"
                                     >
                            <p:ajax immediate="true" event="keyup"  
                                    listener="#{orderInquiry.handleCreditCardKeyEvent}"
                                    update=":inqyTab:formEdit:edtCardBank" process="@this"></p:ajax>
                        </p:inputMask> 
                    </p:column>
                    <p:column><p:message for="cbCreditCard"></p:message></p:column>
                </p:row>
                <p:row>
                    <p:column><h:outputLabel value="#{message['Inquiry.CardBank']}"></h:outputLabel> </p:column>
                    <p:column>
                        <p:selectOneMenu id="edtCardBank" value="#{orderInquiry.instance.paymentInfo.cardBank}" 
                                         converter="omnifaces.SelectItemsConverter"
                                         required="false">
                                <f:selectItem noSelectionOption="true" itemLabel="Seçiniz"/>
                                <f:selectItems value="#{orderInquiry.cardBanks}" 
                                               var="pbank" itemLabel="#{pbank.bankName}" itemValue="#{pbank}"></f:selectItems>                          
                        </p:selectOneMenu>         
                    </p:column>
                    <p:column><p:message for="edtCardBank"></p:message></p:column>
                </p:row>
                <p:row>
                    <p:column><h:outputLabel value="#{message['Inquiry.CreditCardHolder']}"></h:outputLabel> </p:column>
                    <p:column>
                        <p:inputText id="edtHolder" value="#{orderInquiry.instance.paymentInfo.cardHolder}" size="30" maxlength="120"></p:inputText>
                    </p:column>
                    <p:column><p:message for="edtHolder"></p:message></p:column>
                </p:row>
                <p:row>
                    <p:column><h:outputLabel value="#{message['Inquiry.PayAmount']}"></h:outputLabel> </p:column>
                    <p:column>
                        <p:panelGrid columns="2" style="border-style: hidden !important;" >
                            <p:inputText id="edtPayAmount"
                                         value="#{orderInquiry.instance.paymentInfo.payAmount}"
                                     required="false" size="18" maxlength="16"/>
                            <p:selectOneMenu id="edtPayCurrency"
                                             value="#{orderInquiry.instance.paymentInfo.payCurrency}"
                                         required="false">
                                <f:selectItems value="#{enums.currencySelect}"></f:selectItems>
                            </p:selectOneMenu>
                        </p:panelGrid>
                    </p:column>
                    <p:column><p:message for="edtPayAmount"></p:message><p:message for="edtPayCurrency"></p:message></p:column>
                </p:row>


            </p:panelGrid>
        </p:fieldset>
        
    </p:panelGrid>    
    <br/>
    <p:commandButton value="#{message['Global.Save']}" 
                     actionListener="#{orderInquiry.save()}"
                     update=":inqyTab:formEdit:growl,:inqyTab:formEdit:inquiryPanel,:inqyTab">
    </p:commandButton>

    <p:commandButton value="#{message['Global.NewRecord']}" action="#{orderInquiry.newRecord()}" 
                      class="GreenButton"
                      update=":inqyTab:formEdit:growl,:inqyTab:formEdit:inquiryPanel,:inqyTab"
                     rendered="#{orderInquiry.instance.managed}"
                     >
   </p:commandButton>

    <p:commandButton value="#{message['Global.BackToList']}" action="orderInquirySearch.xhtml?faces-redirect=true"
                     class="RedButton" process="@this"
                     rendered="#{orderInquiry.instance.managed}"
                     >
   </p:commandButton>

   <p:confirmDialog global="true" showEffect="fade" hideEffect="explode">
        <p:commandButton value="Yes" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
        <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
   </p:confirmDialog>
    
    <style>
         .ui-selectonemenu .ui-selectonemenu-label {
            display: block;
            border: none;
            white-space: nowrap;
            overflow: hidden;
            font-weight: normal;
            width: 94% !important;
            text-align: left;
          }
          @media (max-width: 1372px){
            .ui-grid .ui-grid-row {
              clear: both;
              display: inline !important;
            }
          }
    </style>
</ui:composition>